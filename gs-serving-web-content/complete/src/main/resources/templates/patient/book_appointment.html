<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>Đặt lịch khám</title>
    <meta charset="UTF-8" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="container my-4">
    <h2>Đặt lịch khám</h2>

    <!-- Form lọc Khoa và Bác sĩ -->
    <form th:action="@{/patient/book}" method="get" class="row g-3 mb-4">
      <div class="col-md-4">
        <label class="form-label">Chọn Khoa</label>
        <select
          name="departmentId"
          class="form-select"
          onchange="this.form.submit()"
        >
          <option value="">-- Tất cả khoa --</option>
          <option
            th:each="dept : ${departments}"
            th:value="${dept.id}"
            th:text="${dept.name}"
            th:selected="${dept.id} == ${param.departmentId}"
          ></option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Chọn Bác sĩ</label>
        <select
          name="doctorId"
          class="form-select"
          onchange="this.form.submit()"
        >
          <option value="">-- Tất cả bác sĩ --</option>
          <option
            th:each="doc : ${doctors}"
            th:value="${doc.id}"
            th:text="${doc.fullName}"
            th:selected="${doc.id} == ${param.doctorId}"
          ></option>
        </select>
      </div>
    </form>

    <!-- Bảng danh sách ca khám trống -->
    <div th:if="${#lists.isEmpty(shifts)}">
      <div class="alert alert-info">Không có ca khám nào khả dụng.</div>
    </div>

    <div th:if="${!#lists.isEmpty(shifts)}">
      <form th:action="@{/patient/book}" method="post">
        <table class="table table-bordered">
          <thead class="table-light">
            <tr>
              <th>Ngày</th>
              <th>Giờ bắt đầu</th>
              <th>Giờ kết thúc</th>
              <th>Bác sĩ</th>
              <th>Phòng</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="s : ${shifts}">
              <td th:text="${s.date}"></td>
              <td th:text="${#temporals.format(s.startTime, 'HH:mm')}"></td>
              <td th:text="${#temporals.format(s.endTime, 'HH:mm')}"></td>
              <td th:text="${s.doctor.fullName}"></td>
              <td
                th:text="${s.room != null ? s.room.roomNumber : 'Chưa chọn'}"
              ></td>
              <td>
                <input type="hidden" name="shiftId" th:value="${s.id}" />
                <input
                  type="hidden"
                  name="patientId"
                  value="/* ID bệnh nhân sẽ được xử lý ở controller */"
                />
                <button type="submit" class="btn btn-primary btn-sm">
                  Đặt lịch
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </form>
    </div>

    <a th:href="@{/patient/dashboard}" class="btn btn-secondary mt-3"
      >Quay lại Dashboard</a
    >
  </body>
</html>
